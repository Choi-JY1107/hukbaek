FROM node:20-alpine

WORKDIR /app

# pnpm 설치
RUN npm install -g pnpm

# 루트 설정 파일들 복사
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./
COPY tsconfig.base.json ./

# 패키지 파일들 복사
COPY packages/shared/package.json ./packages/shared/package.json
COPY packages/shared/tsconfig.json ./packages/shared/tsconfig.json
COPY apps/frontend/package.json ./apps/frontend/package.json
COPY apps/frontend/tsconfig.json ./apps/frontend/tsconfig.json
COPY apps/frontend/tsconfig.node.json ./apps/frontend/tsconfig.node.json
COPY apps/frontend/vite.config.ts ./apps/frontend/vite.config.ts
COPY apps/frontend/svelte.config.js ./apps/frontend/svelte.config.js

# 의존성 설치
RUN pnpm install

# 소스 코드는 volume으로 마운트됨

EXPOSE 5173

# Vite dev server를 host 모드로 실행 (Docker 네트워크에서 접근 가능하도록)
CMD ["sh", "-c", "cd /app/apps/frontend && pnpm dev --host"]
